language: node_js

node_js:
- "9"

before_install:
- npx version-from-git --travis

install:
- npm install
- npm run install-test

before_script:
- npm run build
- npm run build-test

script:
# Our tests currently don't run on Travis, disabling them for now
- npm --version

before_deploy:
- git config --local user.name "Bot Framework"
- git config --local user.email "botframework@microsoft.com"

deploy:
- provider: npm
  api_key: $NPM_TOKEN
  email: "botframework@microsoft.com"
  on:
    branch: v3
  skip_cleanup: true
  tag: legacy

- provider: script
  script: bash scripts/deploycdn.sh
  skip_cleanup: true
  on:
    branch: v3
